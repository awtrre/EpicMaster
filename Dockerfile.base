# Dockerfile.base
FROM python:3.11-slim-bookworm

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    DISPLAY=:1 \
    VNC_PORT=6080 \
    NO_VNC_HOME=/opt/novnc

# âš¡ï¸ æ¢å›½å†…æºï¼ˆæ¸…åæºï¼‰ï¼ŒåŠ é€Ÿä¸‹è½½
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources

# ğŸ“¦ å®‰è£…æ‰€æœ‰é‡å‹ä¾èµ–ï¼ˆåªè¿è¡Œè¿™ä¸€æ¬¡ï¼ï¼‰
RUN apt-get update && apt-get install -y --no-install-recommends \
    chromium \
    chromium-driver \
    xvfb \
    x11vnc \
    fluxbox \
    net-tools \
    procps \
    curl \
    git \
    libnss3 \
    libxss1 \
    libasound2 \
    libatk-bridge2.0-0 \
    libgtk-3-0 \
    libgbm1 \
    fonts-liberation \
    libu2f-udev \
    xdg-utils \
    && rm -rf /var/lib/apt/lists/*

# ğŸ“¦ å®‰è£… NoVNC
RUN git clone --depth 1 https://github.com/novnc/noVNC.git $NO_VNC_HOME \
    && git clone --depth 1 https://github.com/novnc/websockify $NO_VNC_HOME/utils/websockify \
    && ln -s $NO_VNC_HOME/vnc.html $NO_VNC_HOME/index.html

# ğŸ“¦ é¢„è£… Python ä¾èµ–ï¼ˆå¦‚æœ requirements å˜åŠ¨ä¸é¢‘ç¹ï¼Œä¹Ÿå¯ä»¥æ”¾è¿™é‡Œï¼‰
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
